<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>挂号界面</title>

<script type="text/javascript"
	src="/admin/static/assets/jquery/jquery-1.10.2.min.js"></script>

<script type="text/javascript"
	src="/admin/static/assets/jquery/jquery.form.js"></script>

<script type="text/javascript"
	src="/admin/static/assets/artDialog/artDialog.js??skin=idialog"></script>

<script type="text/javascript"
	src="/admin/static/assets/artDialog/plugins/iframeTools.js"></script>


<script type="text/javascript">

	function process(doctorId, date, period, departmentId) {
		$.ajax({
			url : "/register/save/?doctorId=" + doctorId + "&date=" + date
					+ "&period=" + period + "&departmentId=" + departmentId,
			dataType : "json",
			error : function(data) {
				alert("预约失败！");
				art.dialog.close();
			},
			success : function(data) {
				alert(data.data);
				art.dialog.close();
			}
		});
	}
	
</script>

</head>
<body>
	<div>科室：${(department.name)!}</div>
	<div>日期：${date!}</div>
	<table>
		<thead>
			<tr>
				<th>医生</th>
				<th>职位</th>
				<th>上午可预约</th>
				<th>下午可预约</th>
				<th>预约</th>
			</tr>
		</thead>
		<tbody>
			<#list doctors as doctor>
			<tr>
				<td align="center"><input type="hidden" name="doctorId" value="${doctor.id}" />
					${(doctor.name)!}</td>
				<td align="center">${doctor.getRole().name}</td>
				<td align="center">
					${(doctor.getSchedule(date).amTotal - doctor.getSchedule(date).amNum)!}
				</td>
				<td align="center">${(doctor.getSchedule(date).pmTotal-doctor.getSchedule(date).pmNum)!}</td>
				<td align="center">
					<a href="javascript:void()"
						<#if (doctor.getSchedule(date).amTotal == doctor.getSchedule(date).amNum)>
							style="color:#ccc;"
						<#else>
							onclick="process('${(doctor.id)!}','${date!}','am','${(doctor.departmentid)!}')"
						</#if>
					title="点击预约" >上午</a>
					&nbsp;
					<a href="javascript:void()"
						<#if (doctor.getSchedule(date).pmTotal == doctor.getSchedule(date).pmNum)>
							style="color:#ccc;"
						<#else>
							onclick="process('${(doctor.id)!}','${date!}','pm','${(doctor.departmentid)!}')"
						</#if>
					title="点击预约">下午</a>
				</td>
			</tr>
			</#list>
		</tbody>
	</table>
</body>
</html>