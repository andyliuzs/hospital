<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<title>挂号界面</title>
	
	<link rel="stylesheet" type="text/css" href="${CONTEXT_PATH}/static/css/home.css" />
	<script type="text/javascript" src="${CONTEXT_PATH}/static/js/jquery-1.10.2.min.js"></script>
	<script type="text/javascript">
	
		function process(doctorId, date, period, departmentId) {
			$.ajax({
				url : "${CONTEXT_PATH}/register/save/?doctorId=" + doctorId + "&date=" + date
						+ "&period=" + period + "&departmentId=" + departmentId,
				dataType : "json",
				error : function(data) {
					alert("预约失败！");
					art.dialog.close();
				},
				success : function(data) {
					alert(data.data);
					art.dialog.close();
				}
			});
		}
		
	</script>

</head>
<body>
	<div>
		<table class="gridtable" style="width: 100%">
			<tr>
				<th width="80" align="center">科室</th>
				<td>${(department.name)!}</td>
				<th width="80" align="center">日期</th>
				<td>${showDate!}</td>
			</tr>
		</table>
	</div>
	<div>
		<table class="gridtable" style="width: 100%;margin-top: 25px;">
			<thead align="center">
				<tr>
					<th>医生</th>
					<th>职位</th>
					<th>上午可预约</th>
					<th>上午剩余</th>
					<th>下午可预约</th>
					<th>下午剩余</th>
					<th>预约</th>
				</tr>
			</thead>
			<tbody>
				<#list doctors as doctor>
				<tr>
					<td align="center">
						<input type="hidden" name="doctorId" value="${doctor.id}" />
						${(doctor.name)!}</td>
					<td align="center">${doctor.getRole().name}</td>
					<td align="center">
						${doctor.getSchedule(date).amTotal} 
					</td>
					<td align="center">
						${doctor.getSchedule(date).amTotal - doctor.getSchedule(date).amNum}
					</td>
					<td align="center">${doctor.getSchedule(date).pmTotal}</td>
					<td align="center">${doctor.getSchedule(date).pmTotal - doctor.getSchedule(date).pmNum}</td>
					<td align="center">
						<a href="javascript:void()"
							<#if (doctor.getSchedule(date).amTotal == doctor.getSchedule(date).amNum)>
								style="color:#ccc;"
							<#else>
								onclick="process('${(doctor.id)!}','${date!}','am','${(doctor.departmentid)!}')"
							</#if>
						title="点击预约" >上午</a>
						&nbsp;
						<a href="javascript:void()"
							<#if (doctor.getSchedule(date).pmTotal! == doctor.getSchedule(date).pmNum!)>
								style="color:#ccc;"
							<#else>
								onclick="process('${(doctor.id)!}','${date!}','pm','${(doctor.departmentid)!}')"
							</#if>
						title="点击预约">下午</a>
					</td>
				</tr>
				</#list>
			</tbody>
		</table>
	</div>
</body>
</html>