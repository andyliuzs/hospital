<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>预约列表</title>
	
	<link rel="stylesheet" type="text/css" href="${CONTEXT_PATH}/admin/static/css/calendar.css" />
	<link rel="stylesheet" type="text/css" href="${CONTEXT_PATH}/admin/static/css/data.css" />
	
	<script type="text/javascript" src="${CONTEXT_PATH}/admin/static/js/jquery-1.10.2.min.js"></script>
	<script type="text/javascript" src="${CONTEXT_PATH}/admin/static/js/artDialog/artDialog.js??skin=blue"></script>
	<script type="text/javascript" src="${CONTEXT_PATH}/admin/static/js/artDialog/plugins/iframeTools.js"></script>
	<script type="text/javascript" src="${CONTEXT_PATH}/admin/static/js/minform/minform.js"></script>
	<script type="text/javascript" src="${CONTEXT_PATH}/admin/static/js/minform/drcal.js"></script>
	
	<script type="text/javascript">

		function verify(status,regId){
	        $.ajax({ 
	        	url: "${CONTEXT_PATH}/admin/register/verify/?status=" + status+"&regId="+regId, 
	        	dataType: "json", 
	        	error:function(data){
					alert(data.data);
 		    	},
	        	success: function(data) { 
					alert(data.data);
					location.reload();
	        	}
	        }); 
		}
		
		function update() {
			var value = $("#department").val();
			$.getJSON("${CONTEXT_PATH}/admin/register/getDoctors/" + value, function (data) {
                //对请求返回的JSON格式进行分解加载
                $.each(data.json, function(idx, item) {
                    $("#doctor").append($("<option/>").text(item).attr("value",idx));
                });
            });
		}
		
		$(function() {
			
			update();
			
			$("#department").change(function(){  
				
				update();
				
			});
		});
		
		
	</script>
</head>
<body>
	<div class="search-box">
		<form name="searchForm" action="${CONTEXT_PATH}/admin/register/search" method="post">
			<span>
				日期
				<select name="date">
					<option value="">挂号日期</option> 
					<#list futureDays as date>
						<option value="${date}" <#if date == searchDate>selected="selected"</#if> >${date}</option>
					</#list>
				</select>
				&nbsp;&nbsp;科室
				<select id="department" name="departmentId">
					<option value="-1">请选择科室</option>
					<#list departments as department>
						<#if department.id == searchDepartmentId>
							<option value="${(department.id)!}" selected="selected">${(department.name)!}</option>
						<#else>
							<option value="${(department.id)!}">${(department.name)!}</option>
						</#if>
					</#list>
				</select>
				&nbsp;&nbsp;医生
				<select id="doctor" name="doctorId">
					<option value="-1">请选择医生</option> 
				</select>
				
				<input type="submit" name="subButton" id="subButton" value="查询" />		
			</span>
		</form>
	</div>
	
	<div class="data-box">
		<table class="gridtable">
			<thead align="center">
				<tr>
					<th width="120">日期</th>
					<th width="80">批次</th>
					<th width="100">预约人</th>
					<th width="100">科室</th>
					<th width="80">医生</th>
					<th width="120">职称</th>
					<th width="120">审核状态</th>
				</tr>
			</thead>
			<tbody>
				<#list registerList.list as reg>
				<tr>
					<td align="center">${(reg.date)!}</td>
					<td align="center"><#if reg.period==0>上午 <#else>下午</#if></td>
					<td align="center">${reg.getUser().name}</td>
					<td align="center">${(reg.getDepartment().name)!}</td>
					<td align="center">${(reg.getDoctor().name)!}</td>
					<td align="center">${(reg.getDoctor().getRole().name)!}</td>
					<td align="center">
						<#if reg.verify == 0>
							<#if reg.date?date("yyyy-MM-dd") gt today?date("yyyy-MM-dd")>
								<a href="javascript:void()" onclick="verify(1,${(reg.id)!})">通过</a>&nbsp;
								<a href="javascript:void()" onclick="verify(2,${(reg.id)!})">拒绝</a>
							<#else>
								已过期
							</#if>
						<#elseif reg.verify == 1>
							已通过
						<#elseif reg.verify == 2>
							已拒绝
						<#elseif reg.verify == 3>
							已取消
						</#if>
					</td>
				</tr>
				</#list>

			</tbody>
		</table>
	</div>

	<div class="page-box">
		<span style="margin-left: 10px"> 
		共${registerList.totalRow}条记录&nbsp;共${registerList.totalPage}页  每页${registerList.pageSize}条数据  当前第${registerList.pageNumber}页     
		<a href="${CONTEXT_PATH}/admin/register/?p=1<#if searchPage == 1>&s=1</#if>" >[首页]</a>
		<a href="${CONTEXT_PATH}/admin/register/?p=<#if registerList.pageNumber lte 1>1<#else>${registerList.pageNumber - 1}</#if><#if searchPage == 1>&s=1</#if>" >[上一页]</a> 
		<a href="${CONTEXT_PATH}/admin/register/?p=<#if registerList.pageNumber gte registerList.totalPage>${registerList.totalPage}<#else>${registerList.pageNumber + 1}</#if><#if searchPage == 1>&s=1</#if>" >[下一页]</a> 
		<a href="${CONTEXT_PATH}/admin/register/?p=${registerList.totalPage}<#if searchPage == 1>&s=1</#if>" >[末页]</a>
		 
		</span>
	</div>
</body>
</html>